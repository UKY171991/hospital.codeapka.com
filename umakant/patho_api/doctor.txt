Doctor API - patho_api/doctor.php

Base URL:
https://hospital.codeapka.com/umakant/patho_api/doctor.php

Supported actions: list, get, save, delete

Summary of important behavior (current implementation):
- Authentication accepted:
  - Session cookie (PHPSESSID)
  - Bearer token via Authorization: Bearer <api_token> (users.api_token)
  - api_key request parameter
  - username/password in the same request (form-data or JSON) as a credential fallback
  - Shared secret via X-Api-Key header or secret_key param (server-to-server)
  - If no authenticated user is found, the API will still allow inserts but `added_by` will fall back to the configured `PATHO_API_DEFAULT_USER_ID` (if set in `inc/api_config.php`) instead of remaining NULL.

- Upsert behavior on save:
  - Creates a new doctor if not found by unique key.
  - If a matching row exists the helper compares provided columns: if all provided columns match existing data the call is "skipped"; if any provided column differs the row is updated.
  - Unique criteria: registration_no (if provided) else name+phone+hospital.

1) List doctors
- Method: GET
- URL: /patho_api/doctor.php?action=list
- Query params:
  - user_id (optional): return doctors added by this user. If omitted and you are authenticated, returns doctors added by the current session user.
  - all=1 (optional): if viewer role is `master` and all=1, returns all doctors.
- Authentication: session/token/secret as above (listing typically requires authentication unless you expose it publicly).
- Response example:
  { "success": true, "data": [ { /* doctor columns + added_by_username */ }, ... ] }

2) Get single doctor
- Method: GET
- URL: https://hospital.codeapka.com/umakant/patho_api/doctor.php?action=get&id=<id>
- Response example:
  { "success": true, "data": { /* doctor columns + added_by_username */ } }

3) Create / Save doctor (upsert)
- Method: POST
- URL: https://hospital.codeapka.com/umakant/patho_api/doctor.php?action=save
- Auth: any of the accepted auth methods above; if no auth supplied API still inserts but uses `PATHO_API_DEFAULT_USER_ID` for `added_by` when configured.
- Content-Type: application/json or application/x-www-form-urlencoded
- Body keys (provided fields are compared during upsert):
  - name (required)
  - qualification
  - specialization
  - hospital
  - contact_no
  - phone
  - email
  - address
  - registration_no
  - percent
  - added_by
- Notes:
  - Client-supplied `id` is ignored for new inserts (if `id` is present and numeric it's treated as update).
  - `added_by` is controlled server-side (clients may not set it unless the authenticated user role is master/admin and submits `added_by`).
  - Upsert returns an `action` of `inserted`, `updated`, or `skipped` and the `id`.
- Successful response example:
  { "success": true, "message": "Doctor inserted", "id": 123 }

4) Update doctor (edit)
- Method: POST
- URL: /patho_api/doctor.php?action=save
- Body: include id=<existing id> plus fields to update
- Behavior: if id present and numeric, API updates that doctor and returns {success:true,message:'Doctor updated',id:<id>}

5) Delete doctor
- Method: POST
- URL: /patho_api/doctor.php?action=delete
- Body: id=<id>
- Auth/permission: only master/admin or the creator (added_by) can delete
- Response: {"success":true,"message":"Doctor deleted"}

Quick Postman/PowerShell examples
- Login (to get session cookie):
  POST https://hospital.codeapka.com/umakant/login.php  (form: username, password, ajax=1)

- Create using secret header (server-to-server):
  POST https://hospital.codeapka.com/umakant/patho_api/doctor.php?action=save
  Headers: X-Api-Key: <PATHO_API_SECRET>, Content-Type: application/json
  Body: { "name":"Dr A","registration_no":"REG-1" }

Notes
- Make sure `PATHO_API_DEFAULT_USER_ID` is set on the server (env or `inc/api_config.php`) if you want server-side inserts to record a non-null `added_by`.

If you want, I can produce an updated Postman collection that matches these behaviors.

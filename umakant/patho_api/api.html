<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation & Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Base Styles */
        * {
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        /* Mobile-First Header */
        .mobile-header {
            display: none;
            background: #fff;
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 1050;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mobile-header .navbar-brand {
            font-size: 1.25rem;
            font-weight: 600;
            color: #0d6efd;
            text-decoration: none;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #0d6efd;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background-color: #f8f9fa;
        }

        /* Enhanced Sidebar */
        .sidebar {
            width: 280px;
            background: #fff;
            border-right: 1px solid #dee2e6;
            padding: 20px;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 1040;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0d6efd;
            margin: 0;
        }

        .sidebar-close {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6c757d;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sidebar-close:hover {
            background-color: #f8f9fa;
            color: #0d6efd;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 20px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
            width: calc(100% - 280px);
            max-width: calc(100vw - 280px);
            overflow-x: hidden;
        }

        .container-fluid {
            padding-left: 0;
            padding-right: 0;
            max-width: 100%;
            overflow-x: hidden;
        }

        /* API List Styling */
        .api-list .list-group-item {
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            margin-bottom: 8px;
            border-radius: 8px;
            padding: 12px 16px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .api-list .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .api-list .list-group-item.active {
            background-color: #0d6efd;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
        }

        .api-list .list-group-item.active:hover {
            transform: translateX(0);
            background-color: #0b5ed7;
        }

        /* Test All Button */
        #test-all-btn {
            border-radius: 8px;
            font-weight: 600;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
            transition: all 0.3s ease;
        }

        #test-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
        }

        /* Code Viewer */
        .code-viewer {
            background: #212529;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            border: 1px solid #495057;
            width: 100%;
            max-width: 100%;
            word-wrap: break-word;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .code-viewer code {
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-all;
            display: block;
            width: 100%;
        }

        /* Fix for pre elements */
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-all;
            overflow-wrap: break-word;
            max-width: 100%;
            margin: 0;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Endpoint Cards */
        .endpoint-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
        }

        .endpoint-card .card-body {
            overflow-x: hidden;
            word-wrap: break-word;
        }

        .endpoint-card .card-body p,
        .endpoint-card .card-body code {
            word-wrap: break-word;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        .endpoint-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
            border-color: #0d6efd;
        }

        .endpoint-card .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 1rem 1.5rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 1rem;
            overflow-x: auto;
            flex-wrap: nowrap;
            scrollbar-width: thin;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }

        /* Fix for tab content */
        .tab-content {
            overflow-x: hidden;
            width: 100%;
        }

        .tab-pane {
            overflow-x: hidden;
            width: 100%;
        }

        .nav-tabs .nav-link {
            border-radius: 8px 8px 0 0;
            margin-right: 8px;
            padding: 12px 20px;
            font-weight: 500;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            border-color: #dee2e6;
            background-color: #f8f9fa;
        }

        .nav-tabs .nav-link.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
            color: white;
            box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
        }

        /* Badges and Status */
        .badge-status {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        /* Breadcrumb */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 1rem;
        }

        .breadcrumb-item+.breadcrumb-item::before {
            content: "â€º";
            font-weight: 600;
            color: #6c757d;
        }

        /* Alerts */
        .alert {
            border-radius: 8px;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Buttons */
        .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.875rem;
        }

        /* Overlay for mobile sidebar */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1030;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
        }

        /* Responsive Design */

        /* Large Tablets and Small Desktops */
        @media (max-width: 1200px) {
            .sidebar {
                width: 260px;
            }

            .main-content {
                margin-left: 260px;
            }
        }

        /* Tablets */
        @media (max-width: 992px) {
            .sidebar {
                width: 240px;
            }

            .main-content {
                margin-left: 240px;
                padding: 15px;
            }

            .code-viewer {
                font-size: 12px;
                max-height: 300px;
            }
        }

        /* Small Tablets and Large Phones */
        @media (max-width: 768px) {
            .mobile-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100vh;
                transform: translateX(-100%);
                z-index: 1040;
                padding-top: 70px;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .sidebar-close {
                display: block;
                position: absolute;
                top: 15px;
                right: 15px;
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
                padding-top: 80px;
                width: 100%;
                max-width: 100vw;
                overflow-x: hidden;
            }

            .container-fluid {
                padding-left: 10px;
                padding-right: 10px;
                max-width: calc(100vw - 20px);
            }

            .nav-tabs .nav-link {
                padding: 8px 12px;
                font-size: 0.875rem;
                margin-right: 4px;
            }

            .endpoint-card .card-header {
                padding: 1rem;
            }

            .endpoint-card .card-header h5 {
                font-size: 1rem;
            }

            .code-viewer {
                font-size: 11px;
                padding: 10px;
                max-height: 250px;
                overflow-x: auto;
                white-space: pre-wrap;
                word-break: break-all;
                max-width: calc(100vw - 50px);
            }

            .code-viewer code {
                font-size: 11px;
                white-space: pre-wrap;
                word-break: break-all;
            }

            .alert {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }

        /* Mobile Phones */
        @media (max-width: 576px) {
            .mobile-header {
                padding: 0.75rem 1rem;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
                padding-top: 60px;
            }

            .main-content {
                padding: 10px;
                padding-top: 70px;
                width: 100%;
                max-width: 100vw;
                overflow-x: hidden;
            }

            .container-fluid {
                padding-left: 5px;
                padding-right: 5px;
                max-width: calc(100vw - 10px);
            }

            .endpoint-card {
                margin-bottom: 1rem;
            }

            .endpoint-card .card-header {
                padding: 0.75rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .endpoint-card .card-header .btn {
                width: 100%;
                margin-top: 0.5rem;
            }

            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .nav-tabs::-webkit-scrollbar {
                display: none;
            }

            .nav-tabs .nav-link {
                white-space: nowrap;
                min-width: 80px;
                text-align: center;
                padding: 8px 10px;
                font-size: 0.8rem;
            }

            .code-viewer {
                font-size: 10px;
                padding: 8px;
                max-height: 200px;
                overflow-x: auto;
                white-space: pre-wrap;
                word-break: break-all;
                max-width: calc(100vw - 30px);
            }

            .code-viewer code {
                font-size: 10px;
                white-space: pre-wrap;
                word-break: break-all;
            }

            .breadcrumb {
                font-size: 0.875rem;
            }

            .card-body {
                padding: 1rem;
            }

            .alert {
                padding: 0.5rem;
                font-size: 0.8rem;
            }

            .btn-sm {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            #test-all-btn {
                padding: 10px;
                font-size: 0.9rem;
            }

            .api-list .list-group-item {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }

        /* Extra Small Phones */
        @media (max-width: 400px) {
            .mobile-header {
                padding: 0.5rem;
            }

            .main-content {
                padding: 8px;
                padding-top: 65px;
            }

            .sidebar {
                padding: 10px;
                padding-top: 55px;
            }

            .endpoint-card .card-header h5 {
                font-size: 0.9rem;
            }

            .nav-tabs .nav-link {
                padding: 6px 8px;
                font-size: 0.75rem;
                min-width: 70px;
            }

            .code-viewer {
                font-size: 9px;
                padding: 6px;
                max-height: 150px;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .api-list .list-group-item:hover {
                transform: none;
            }

            .endpoint-card:hover {
                transform: none;
            }

            .btn:hover {
                transform: none;
            }

            .nav-tabs .nav-link:hover {
                background-color: transparent;
                border-color: transparent;
            }

            .nav-tabs .nav-link.active:hover {
                background-color: #0d6efd;
                border-color: #0d6efd;
            }
        }

        /* High DPI Displays */
        @media (-webkit-min-device-pixel-ratio: 2),
        (min-resolution: 192dpi) {
            .code-viewer {
                font-size: 13px;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #ffffff;
            }

            .sidebar {
                background: #2d2d2d;
                border-right-color: #404040;
            }

            .mobile-header {
                background: #2d2d2d;
                border-bottom-color: #404040;
            }

            .endpoint-card {
                background: #2d2d2d;
                border-color: #404040;
            }

            .endpoint-card .card-header {
                background: linear-gradient(135deg, #3a3a3a 0%, #2d2d2d 100%);
                border-bottom-color: #404040;
            }
        }

        /* Postman Example Styling */
        .postman-example {
            padding: 1rem 0;
        }

        .postman-header h6 {
            color: #ff6c37;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .postman-instructions .alert {
            background-color: #e7f3ff;
            border-left: 4px solid #0d6efd;
            border-radius: 0 8px 8px 0;
        }

        .postman-instructions h6 {
            color: #0d6efd;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .postman-instructions ol {
            padding-left: 1.2rem;
        }

        .postman-instructions li {
            margin-bottom: 0.25rem;
            color: #495057;
        }

        /* Postman tab icon styling */
        .nav-tabs .nav-link i.fa-rocket {
            color: #ff6c37;
        }

        .nav-tabs .nav-link.active i.fa-rocket {
            color: white;
        }

        /* Comprehensive Overflow Fixes */
        .card,
        .card-body,
        .card-header {
            overflow-x: hidden;
            word-wrap: break-word;
        }

        .alert {
            overflow-x: hidden;
            word-wrap: break-word;
        }

        .breadcrumb {
            overflow-x: hidden;
            word-wrap: break-word;
        }

        /* URL and long text fixes */
        code,
        kbd,
        pre,
        samp {
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        /* Table responsiveness */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Force break long words */
        .force-break {
            word-break: break-all;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        /* Apply force-break to specific elements */
        .endpoint-card p,
        .endpoint-card code,
        .alert p,
        .card-body p {
            word-break: break-word;
            overflow-wrap: break-word;
        }

        /* Print Styles */
        @media print {

            .sidebar,
            .mobile-header,
            .sidebar-overlay {
                display: none !important;
            }

            .main-content {
                margin-left: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .endpoint-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            .code-viewer {
                background: #f8f9fa !important;
                color: #000 !important;
                border: 1px solid #dee2e6 !important;
                white-space: pre-wrap !important;
                word-break: break-all !important;
            }
        }
    </style>
</head>

<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <a href="#" class="navbar-brand">
            <i class="fas fa-code me-2"></i>API Documentation
        </a>
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Layout -->
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="sidebar-header">
                <h4 class="sidebar-title">
                    <i class="fas fa-code me-2"></i>APIs
                </h4>
            </div>
            <div class="d-grid gap-2 mb-3">
                <button id="test-all-btn" class="btn btn-primary">
                    <i class="fas fa-play me-2"></i>Test All APIs
                </button>
            </div>
            <div id="api-list" class="list-group api-list"></div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container-fluid">
                <div id="api-documentation"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const apiEndpoints = [
            {
                name: 'Users',
                file: 'user.php',
                description: 'API for managing users.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all users.' },
                    { action: 'get', method: 'GET', description: 'Get a single user by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a user.' },
                    { action: 'delete', method: 'POST', description: 'Delete a user by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Doctors',
                file: 'doctor.php',
                description: 'API for managing doctors.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all doctors.' },
                    { action: 'get', method: 'GET', description: 'Get a single doctor by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a doctor.' },
                    { action: 'specializations', method: 'GET', description: 'Get list of available specializations.' },
                    { action: 'hospitals', method: 'GET', description: 'Get list of available hospitals.' },
                    { action: 'delete', method: 'POST', description: 'Delete a doctor by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Patients',
                file: 'patient.php',
                description: 'API for managing patients. Shows only current user\'s patients unless admin.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get patients for current user.', params: ['user_id', 'username'] },
                    { action: 'get', method: 'GET', description: 'Get a single patient by ID (user-filtered).', params: ['id', 'user_id', 'username'] },
                    { action: 'save', method: 'POST', description: 'Create or update a patient for current user.', params: ['user_id', 'username'] },
                    { action: 'delete', method: 'POST', description: 'Delete a patient by ID (user-filtered).', params: ['id', 'user_id', 'username'] },
                    { action: 'stats', method: 'GET', description: 'Get patient statistics for current user.', params: ['user_id', 'username'] }
                ]
            },
            {
                name: 'Tests',
                file: 'test.php',
                description: 'Enhanced API for managing laboratory tests with complete field support. Returns all 26 fields from tests table: id, name, category_id, main_category_id, price, unit, specimen, default_result, reference_range, min, max, description, min_male, max_male, min_female, max_female, min_child, max_child, sub_heading, test_code, method, print_new_page, shortcut, added_by, created_at, updated_at. Includes reference ranges for different demographics (general, male, female, child), category relationships, and metadata.',
                endpoints: [
                    { 
                        action: 'list', 
                        method: 'GET', 
                        description: 'Get all tests with server-side pagination, search, and filtering. Returns complete test data with all 26 fields including: Basic Info (id, name, description, test_code, shortcut), Categories (category_id, main_category_id, category_name, main_category_name), Pricing (price), Specimen & Method (unit, specimen, method), Reference Ranges (reference_range, min, max, min_male, max_male, min_female, max_female, min_child, max_child), Settings (sub_heading, print_new_page), Metadata (added_by, added_by_username, created_at, updated_at), Default Results (default_result). Supports DataTables server-side processing with draw, start, length, search parameters.' 
                    },
                    { 
                        action: 'simple_list', 
                        method: 'GET', 
                        description: 'Get simplified list of all tests with complete field data for dropdowns and selections. Returns all 27 database fields without pagination for use in forms and selection lists.' 
                    },
                    { 
                        action: 'get', 
                        method: 'GET', 
                        description: 'Get a single test by ID with all 27 fields including category relationships. Returns: Core Fields (id, name, description, test_code, shortcut), Category Info (category_id, main_category_id, category_name, main_category_name), Clinical Data (price, unit, specimen, method, default_result), Reference Ranges (reference_range, min, max for general, male, female, child demographics), Print Settings (sub_heading, print_new_page), Audit Trail (added_by, added_by_username, created_at, updated_at).', 
                        params: ['id'] 
                    },
                    { 
                        action: 'save', 
                        method: 'POST', 
                        description: 'Create or update a test with support for all 26 test fields. Required: name, main_category_id. Optional: category_id, price (decimal 10,2), unit (varchar 50), specimen (varchar 255), default_result (text), reference_range (varchar 255), min/max (decimal 10,2), description (text), min_male/max_male (decimal 10,2), min_female/max_female (decimal 10,2), min_child/max_child (decimal 10,2), sub_heading (tinyint 0/1), test_code (varchar 100), method (varchar 255), print_new_page (tinyint 0/1), shortcut (varchar 50). Server validates that max >= min for all demographic ranges. Auto-sets added_by, created_at, updated_at.' 
                    },
                    { 
                        action: 'delete', 
                        method: 'POST', 
                        description: 'Delete a test by ID with constraint checking. Requires admin/master role.', 
                        params: ['id'] 
                    },
                    { 
                        action: 'stats', 
                        method: 'GET', 
                        description: 'Get comprehensive test statistics including total tests, active tests, categories count, and entries count.' 
                    },
                    { 
                        action: 'main_categories', 
                        method: 'GET', 
                        description: 'Get list of main test categories for test organization and filtering.' 
                    },
                    { 
                        action: 'categories', 
                        method: 'GET', 
                        description: 'Get list of test categories, optionally filtered by main category. Used for category dropdowns in test forms.', 
                        params: ['main_category_id'] 
                    },
                    { 
                        action: 'categories_by_main', 
                        method: 'GET', 
                        description: 'Get test categories filtered by main category ID. Returns categories belonging to specific main category.', 
                        params: ['main_category_id'] 
                    },
                    { 
                        action: 'debug', 
                        method: 'GET', 
                        description: 'Debug endpoint for troubleshooting API issues and checking authentication. Returns system info and table structure.' 
                    }
                ],
                fields: {
                    'Core Fields': {
                        'id': 'int(11) NOT NULL AUTO_INCREMENT - Primary key',
                        'name': 'varchar(255) NOT NULL - Test name/title',
                        'description': 'text DEFAULT NULL - Detailed test description',
                        'test_code': 'varchar(100) DEFAULT NULL - Unique test code/identifier',
                        'shortcut': 'varchar(50) DEFAULT NULL - Keyboard shortcut for quick access'
                    },
                    'Category & Organization': {
                        'category_id': 'int(11) DEFAULT NULL - Foreign key to categories table',
                        'main_category_id': 'int(11) NOT NULL - Foreign key to main_test_categories table',
                        'sub_heading': 'tinyint(1) NOT NULL DEFAULT 0 - Whether test is a sub-heading/grouping'
                    },
                    'Clinical & Pricing': {
                        'price': 'decimal(10,2) NOT NULL DEFAULT 0.00 - Test price',
                        'unit': 'varchar(50) DEFAULT NULL - Measurement unit (mg/dL, IU/L, etc.)',
                        'specimen': 'varchar(255) DEFAULT NULL - Required specimen type (blood, urine, etc.)',
                        'method': 'varchar(255) DEFAULT NULL - Testing method/technique',
                        'default_result': 'text DEFAULT NULL - Default/template result text'
                    },
                    'Reference Ranges': {
                        'reference_range': 'varchar(255) DEFAULT NULL - General reference range text',
                        'min': 'decimal(10,2) DEFAULT NULL - General minimum normal value',
                        'max': 'decimal(10,2) DEFAULT NULL - General maximum normal value',
                        'min_male': 'decimal(10,2) DEFAULT NULL - Male-specific minimum value',
                        'max_male': 'decimal(10,2) DEFAULT NULL - Male-specific maximum value',
                        'min_female': 'decimal(10,2) DEFAULT NULL - Female-specific minimum value',
                        'max_female': 'decimal(10,2) DEFAULT NULL - Female-specific maximum value',
                        'min_child': 'decimal(10,2) DEFAULT NULL - Child-specific minimum value',
                        'max_child': 'decimal(10,2) DEFAULT NULL - Child-specific maximum value'
                    },
                    'Print & Display Settings': {
                        'print_new_page': 'tinyint(1) NOT NULL DEFAULT 0 - Whether to start new page when printing'
                    },
                    'Audit & Metadata': {
                        'added_by': 'int(11) DEFAULT NULL - User ID who created the test',
                        'created_at': 'datetime DEFAULT NULL - Creation timestamp',
                        'updated_at': 'datetime DEFAULT NULL - Last update timestamp'
                    }
                }
            },
            {
                name: 'Test Categories',
                file: 'test_category.php',
                description: 'API for managing test categories.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all test categories.' },
                    { action: 'get', method: 'GET', description: 'Get a single test category by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a test category.' },
                    { action: 'delete', method: 'POST', description: 'Delete a test category by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Main Test Categories',
                file: 'main_test_category.php',
                description: 'API for managing main test categories (used by main-test-category.php).',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all main test categories.' },
                    { action: 'get', method: 'GET', description: 'Get a single main category by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a main test category.' },
                    { action: 'delete', method: 'POST', description: 'Delete a main test category by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Entries',
                file: 'entry.php',
                description: 'Comprehensive API for managing test entries with full CRUD operations. Handles patient test entries with multiple tests per entry, pricing, discounts, and test results. Supports entry aggregation, duplicate prevention, and detailed test information including reference ranges.',
                endpoints: [
                    { 
                        action: 'list', 
                        method: 'GET', 
                        description: 'Get all test entries with patient, doctor, and test information. Returns entries with dynamically fetched test names using GROUP_CONCAT. Each entry includes: id, patient details (patient_id, patient_name, patient_uhid), doctor details (doctor_id, doctor_name), test information (test_names, tests_count), pricing (subtotal, discount_amount, total_price), status, priority, dates (entry_date, created_at, updated_at), and metadata (added_by, added_by_username). Filtered by user scope unless admin.' 
                    },
                    { 
                        action: 'get', 
                        method: 'GET', 
                        description: 'Get complete details of a single test entry by ID. Returns entry with all fields plus associated tests array. Each test includes: entry_test_id, test_id, test_name, category_id, category_name, result_value, unit, min/max values (general, male, female, child), reference_range, price, discount_amount, total_price, status, remarks, and timestamps. Patient info includes: name, uhid, age, gender, contact, address. Doctor info includes: name, specialization.', 
                        params: ['id'] 
                    },
                    { 
                        action: 'save', 
                        method: 'POST', 
                        description: 'Create new entry or update existing entry with tests. Required: patient_id, tests (JSON array). Optional: id (for update), doctor_id, entry_date, status (pending/completed/cancelled), priority (normal/urgent/emergency/routine), referral_source, notes, subtotal, discount_amount, total_price, date_slot, service_location, collection_address. Tests array format: [{test_id, category_id, main_category_id, result_value, unit, min, max, price, discount_amount, remarks, status}]. Automatically handles: duplicate test prevention, category_id/main_category_id defaults to 0 if not provided, entry aggregate refresh (tests_count, test_names, test_ids), transaction rollback on error. Returns saved entry with all details.' 
                    },
                    { 
                        action: 'update', 
                        method: 'POST', 
                        description: 'Alias for save action. Updates existing entry when id is provided. Same parameters as save action.' 
                    },
                    { 
                        action: 'delete', 
                        method: 'POST', 
                        description: 'Delete a test entry by ID. Also deletes all associated tests from entry_tests table. Requires delete permission and user scope validation.', 
                        params: ['id'] 
                    },
                    { 
                        action: 'stats', 
                        method: 'GET', 
                        description: 'Get comprehensive entry statistics. Returns: total entries count, pending entries count, completed entries count, today\'s entries count. Useful for dashboard widgets and reporting.' 
                    },
                    { 
                        action: 'add_test', 
                        method: 'POST', 
                        description: 'Add a single test to an existing entry. Useful for adding tests after entry creation.', 
                        params: ['entry_id', 'test_id'] 
                    },
                    { 
                        action: 'remove_test', 
                        method: 'POST', 
                        description: 'Remove a test from an entry by entry_test_id. Deletes the test association from entry_tests table.', 
                        params: ['entry_test_id'] 
                    },
                    { 
                        action: 'get_tests', 
                        method: 'GET', 
                        description: 'Get all tests associated with a specific entry. Returns array of tests with test details from tests table.', 
                        params: ['entry_id'] 
                    },
                    { 
                        action: 'update_test_result', 
                        method: 'POST', 
                        description: 'Update test result and related fields for a specific test in an entry. Updatable fields: result_value, unit, remarks, status, price, discount_amount.', 
                        params: ['entry_test_id'] 
                    },
                    { 
                        action: 'report_list', 
                        method: 'GET', 
                        description: 'Get filtered list of test entries for reporting. Supports filters: test_id, doctor_id, status, date_from, date_to. Returns flattened data with one row per test for report generation.' 
                    },
                    { 
                        action: 'cleanup_duplicates', 
                        method: 'POST', 
                        description: 'Clean up duplicate test entries (same entry_id and test_id). Keeps oldest entry, deletes duplicates. Returns cleanup statistics. Requires delete permission.' 
                    },
                    { 
                        action: 'refresh_aggregates', 
                        method: 'POST', 
                        description: 'Refresh aggregate data for a specific entry (tests_count, test_names, test_ids, total_price). Useful after manual database changes.', 
                        params: ['entry_id'] 
                    },
                    { 
                        action: 'refresh_all_aggregates', 
                        method: 'POST', 
                        description: 'Refresh aggregate data for all entries in the system. Batch operation for data consistency. Returns count of updated entries.' 
                    }
                ]
            },
            {
                name: 'Notices',
                file: 'notice.php',
                description: 'API for managing notices.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all notices.' },
                    { action: 'get', method: 'GET', description: 'Get a single notice by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a notice.' },
                    { action: 'delete', method: 'POST', description: 'Delete a notice by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Owners',
                file: 'owner.php',
                description: 'API for managing owners.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all owners.' },
                    { action: 'get', method: 'GET', description: 'Get a single owner by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update an owner.' },
                    { action: 'delete', method: 'POST', description: 'Delete an owner by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Dashboard',
                file: 'dashboard.php',
                description: 'Comprehensive dashboard API for pathology management system. Shows user-specific data based on authentication.',
                endpoints: [
                    { action: 'overview', method: 'GET', description: 'Get complete dashboard overview with counts, stats, and metrics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'stats', method: 'GET', description: 'Get detailed statistics (daily, weekly, monthly, yearly) for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'recent_activities', method: 'GET', description: 'Get recent activities and events for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'charts_data', method: 'GET', description: 'Get data for dashboard charts and graphs for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'quick_stats', method: 'GET', description: 'Get quick statistics for today vs yesterday for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'revenue_stats', method: 'GET', description: 'Get comprehensive revenue statistics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'test_performance', method: 'GET', description: 'Get test performance metrics and analytics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'patient_demographics', method: 'GET', description: 'Get patient demographic breakdowns for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'monthly_trends', method: 'GET', description: 'Get monthly trend analysis for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'top_tests', method: 'GET', description: 'Get most popular and profitable tests for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'doctor_performance', method: 'GET', description: 'Get doctor performance metrics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'alerts', method: 'GET', description: 'Get system alerts and notifications for current user.', params: ['test_user_id', 'test_username'] }
                ]
            },
        ];

        const apiList = document.getElementById('api-list');
        const apiDocumentation = document.getElementById('api-documentation');
        const testAllBtn = document.getElementById('test-all-btn');

        function renderApiList() {
            apiList.innerHTML = '';
            apiEndpoints.forEach(api => {
                const a = document.createElement('a');
                a.href = `#${api.file}`;
                a.className = 'list-group-item list-group-item-action';
                a.innerHTML = `${api.name} <span id="test-result-badge-${api.file}" class="badge float-end"></span>`;
                a.onclick = (e) => {
                    e.preventDefault();
                    window.location.hash = api.file;
                    // The hashchange event will handle the rest
                };
                apiList.appendChild(a);
            });
        }

        function generateTestFieldsDocumentation() {
            return `
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fas fa-database me-2"></i>Complete Tests Table Schema (27 Fields)</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>This API returns all 27 fields from the tests database table with complete field support for comprehensive pathology test management.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="text-primary"><i class="fas fa-id-card me-2"></i>Core Fields</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>id</code></td><td>int(11)</td><td>Primary key, auto-increment</td></tr>
                                            <tr><td><code>name</code></td><td>varchar(255)</td><td>Test name/title (required)</td></tr>
                                            <tr><td><code>description</code></td><td>text</td><td>Detailed test description</td></tr>
                                            <tr><td><code>test_code</code></td><td>varchar(100)</td><td>Unique test identifier/code</td></tr>
                                            <tr><td><code>shortcut</code></td><td>varchar(50)</td><td>Keyboard shortcut for quick access</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h5 class="text-primary mt-4"><i class="fas fa-tags me-2"></i>Category & Organization</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>category_id</code></td><td>int(11)</td><td>Foreign key to categories table</td></tr>
                                            <tr><td><code>main_category_id</code></td><td>int(11)</td><td>Foreign key to main_test_categories (required)</td></tr>
                                            <tr><td><code>sub_heading</code></td><td>tinyint(1)</td><td>Whether test is a sub-heading/grouping (0/1)</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h5 class="text-primary mt-4"><i class="fas fa-dollar-sign me-2"></i>Clinical & Pricing</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>price</code></td><td>decimal(10,2)</td><td>Test price (default: 0.00)</td></tr>
                                            <tr><td><code>unit</code></td><td>varchar(50)</td><td>Measurement unit (mg/dL, IU/L, etc.)</td></tr>
                                            <tr><td><code>specimen</code></td><td>varchar(255)</td><td>Required specimen type (blood, urine, etc.)</td></tr>
                                            <tr><td><code>method</code></td><td>varchar(255)</td><td>Testing method/technique</td></tr>
                                            <tr><td><code>default_result</code></td><td>text</td><td>Default/template result text</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="text-primary"><i class="fas fa-chart-line me-2"></i>Reference Ranges (Demographics)</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>reference_range</code></td><td>varchar(255)</td><td>General reference range text</td></tr>
                                            <tr><td><code>min</code></td><td>decimal(10,2)</td><td>General minimum normal value</td></tr>
                                            <tr><td><code>max</code></td><td>decimal(10,2)</td><td>General maximum normal value</td></tr>
                                            <tr><td><code>min_male</code></td><td>decimal(10,2)</td><td>Male-specific minimum value</td></tr>
                                            <tr><td><code>max_male</code></td><td>decimal(10,2)</td><td>Male-specific maximum value</td></tr>
                                            <tr><td><code>min_female</code></td><td>decimal(10,2)</td><td>Female-specific minimum value</td></tr>
                                            <tr><td><code>max_female</code></td><td>decimal(10,2)</td><td>Female-specific maximum value</td></tr>
                                            <tr><td><code>min_child</code></td><td>decimal(10,2)</td><td>Child-specific minimum value</td></tr>
                                            <tr><td><code>max_child</code></td><td>decimal(10,2)</td><td>Child-specific maximum value</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h5 class="text-primary mt-4"><i class="fas fa-print me-2"></i>Print & Display Settings</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>print_new_page</code></td><td>tinyint(1)</td><td>Whether to start new page when printing (0/1)</td></tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h5 class="text-primary mt-4"><i class="fas fa-history me-2"></i>Audit & Metadata</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped">
                                        <thead class="table-dark">
                                            <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr><td><code>added_by</code></td><td>int(11)</td><td>User ID who created the test</td></tr>
                                            <tr><td><code>created_at</code></td><td>datetime</td><td>Creation timestamp</td></tr>
                                            <tr><td><code>updated_at</code></td><td>datetime</td><td>Last update timestamp</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-4">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Important Notes:</h6>
                            <ul class="mb-0">
                                <li><strong>Reference Ranges:</strong> The API supports demographic-specific reference ranges (general, male, female, child) with automatic validation that max â‰¥ min for each range.</li>
                                <li><strong>Categories:</strong> Tests can belong to both a category and main category for hierarchical organization.</li>
                                <li><strong>Validation:</strong> Server-side validation ensures data integrity, proper decimal formatting, and foreign key constraints.</li>
                                <li><strong>Search & Filter:</strong> The list endpoint supports full-text search across name, description, test_code, method, specimen, unit, and category names.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderApiDocumentation(api) {
            // Scroll to top of main content
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.scrollTop = 0;
            }
            // Also scroll window to top on mobile
            if (window.innerWidth <= 768) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            let endpointsHtml = '';
            api.endpoints.forEach(endpoint => {
                endpointsHtml += `
                    <div class="card mb-3 endpoint-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-code me-2"></i>${endpoint.action}</h5>
                            <button class="btn btn-sm btn-primary test-endpoint-btn" data-api-file="${api.file}" data-endpoint-action="${endpoint.action}">
                                <i class="fas fa-play me-1"></i>Test
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="force-break">${endpoint.description}</p>
                            <p><strong>Method:</strong> <span class="force-break">${endpoint.method}</span></p>
                            <p><strong>URL:</strong> <code class="force-break">/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}</code></p>
                            <h6>Code Examples</h6>
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#curl-${api.file}-${endpoint.action}" type="button" role="tab">cURL</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#postman-${api.file}-${endpoint.action}" type="button" role="tab"><i class="fas fa-rocket me-1"></i>Postman</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#js-${api.file}-${endpoint.action}" type="button" role="tab">JavaScript</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#php-${api.file}-${endpoint.action}" type="button" role="tab">PHP</button></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="curl-${api.file}-${endpoint.action}" role="tabpanel">
                                    <div class="position-relative">
                                        <button class="btn btn-sm btn-outline-light position-absolute top-0 end-0 m-2 copy-btn" 
                                                data-copy="${generateCurlExample(api, endpoint).replace(/"/g, '&quot;')}" 
                                                title="Copy to clipboard">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <pre class="code-viewer"><code>${generateCurlExample(api, endpoint)}</code></pre>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="postman-${api.file}-${endpoint.action}" role="tabpanel">
                                    <div class="postman-example">
                                        <div class="postman-header mb-3">
                                            <h6><i class="fas fa-rocket me-2"></i>Postman Collection Example</h6>
                                            <p class="text-muted small">Copy this JSON and import it into Postman as a new collection</p>
                                        </div>
                                        <div class="position-relative">
                                            <div class="btn-group position-absolute top-0 end-0 m-2" role="group">
                                                <button class="btn btn-sm btn-outline-light copy-btn" 
                                                        data-copy="${generatePostmanExample(api, endpoint).replace(/"/g, '&quot;')}" 
                                                        title="Copy Postman Collection">
                                                    <i class="fas fa-copy me-1"></i>Copy
                                                </button>
                                                <button class="btn btn-sm btn-outline-light download-postman-btn" 
                                                        data-api="${api.file}" 
                                                        data-endpoint="${endpoint.action}"
                                                        title="Download Postman Collection">
                                                    <i class="fas fa-download me-1"></i>Download
                                                </button>
                                            </div>
                                            <pre class="code-viewer"><code>${generatePostmanExample(api, endpoint)}</code></pre>
                                        </div>
                                        <div class="postman-instructions mt-3">
                                            <div class="alert alert-info">
                                                <h6><i class="fas fa-info-circle me-2"></i>How to use in Postman:</h6>
                                                <ol class="mb-0 small">
                                                    <li>Copy the JSON above</li>
                                                    <li>Open Postman â†’ Import â†’ Raw text</li>
                                                    <li>Paste the JSON and click Continue</li>
                                                    <li>Update the variables if needed</li>
                                                    <li>Send the request</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="js-${api.file}-${endpoint.action}" role="tabpanel">
                                    <div class="position-relative">
                                        <button class="btn btn-sm btn-outline-light position-absolute top-0 end-0 m-2 copy-btn" 
                                                data-copy="${generateJsExample(api, endpoint).replace(/"/g, '&quot;')}" 
                                                title="Copy to clipboard">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <pre class="code-viewer"><code>${generateJsExample(api, endpoint)}</code></pre>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="php-${api.file}-${endpoint.action}" role="tabpanel">
                                    <div class="position-relative">
                                        <button class="btn btn-sm btn-outline-light position-absolute top-0 end-0 m-2 copy-btn" 
                                                data-copy="${generatePhpExample(api, endpoint).replace(/"/g, '&quot;')}" 
                                                title="Copy to clipboard">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <pre class="code-viewer"><code>${generatePhpExample(api, endpoint)}</code></pre>
                                    </div>
                                </div>
                            </div>
                            <div id="test-result-${api.file}-${endpoint.action}" class="mt-3"></div>
                        </div>
                    </div>
                `;
            });

            apiDocumentation.innerHTML = `
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#" onclick="location.reload()">API Documentation</a></li>
                        <li class="breadcrumb-item active force-break" aria-current="page">${api.name}</li>
                    </ol>
                </nav>
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <h2 class="card-title mb-0 force-break"><i class="fas fa-cogs me-2"></i>${api.name} API</h2>
                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                <button class="btn btn-sm btn-light download-full-collection-btn" 
                                        data-api-file="${api.file}"
                                        title="Download Complete Postman Collection">
                                    <i class="fas fa-rocket me-1"></i>Download Full Collection
                                </button>
                                <span class="badge bg-light text-dark force-break">${api.file}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i><span class="force-break">${api.description}</span>
                        </div>
                        ${api.file === 'test.php' ? generateTestFieldsDocumentation() : ''}
                        ${endpointsHtml}
                    </div>
                </div>
            `;

            // Initialize Bootstrap tabs
            const tabTriggerList = document.querySelectorAll('[data-bs-toggle="tab"]');
            tabTriggerList.forEach(tabTriggerEl => {
                new bootstrap.Tab(tabTriggerEl);
            });

            // Initialize copy buttons
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const textToCopy = e.target.closest('.copy-btn').dataset.copy;
                    const icon = e.target.closest('.copy-btn').querySelector('i');

                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        icon.className = 'fas fa-check';
                        e.target.closest('.copy-btn').classList.remove('btn-outline-light');
                        e.target.closest('.copy-btn').classList.add('btn-success');

                        setTimeout(() => {
                            icon.className = 'fas fa-copy';
                            e.target.closest('.copy-btn').classList.remove('btn-success');
                            e.target.closest('.copy-btn').classList.add('btn-outline-light');
                        }, 2000);
                    } catch (err) {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = textToCopy;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);

                        icon.className = 'fas fa-check';
                        setTimeout(() => {
                            icon.className = 'fas fa-copy';
                        }, 2000);
                    }
                });
            });

            // Initialize Postman download buttons
            document.querySelectorAll('.download-postman-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const apiFile = e.target.closest('.download-postman-btn').dataset.api;
                    const endpointAction = e.target.closest('.download-postman-btn').dataset.endpoint;
                    const api = apiEndpoints.find(a => a.file === apiFile);
                    const endpoint = api.endpoints.find(ep => ep.action === endpointAction);
                    const icon = e.target.closest('.download-postman-btn').querySelector('i');

                    // Generate Postman collection
                    const postmanJson = generatePostmanExample(api, endpoint);

                    // Create download
                    const blob = new Blob([postmanJson], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${api.name.replace(/\s+/g, '_')}_${endpoint.action}_postman_collection.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    // Visual feedback
                    const originalClass = icon.className;
                    icon.className = 'fas fa-check';
                    e.target.closest('.download-postman-btn').classList.remove('btn-outline-light');
                    e.target.closest('.download-postman-btn').classList.add('btn-success');

                    setTimeout(() => {
                        icon.className = originalClass;
                        e.target.closest('.download-postman-btn').classList.remove('btn-success');
                        e.target.closest('.download-postman-btn').classList.add('btn-outline-light');
                    }, 2000);
                });
            });

            // Initialize full collection download buttons
            document.querySelectorAll('.download-full-collection-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const apiFile = e.target.closest('.download-full-collection-btn').dataset.apiFile;
                    const api = apiEndpoints.find(a => a.file === apiFile);
                    const icon = e.target.closest('.download-full-collection-btn').querySelector('i');

                    // Generate full Postman collection
                    const postmanCollection = generateFullPostmanCollection(api);
                    const postmanJson = JSON.stringify(postmanCollection, null, 2);

                    // Create download
                    const blob = new Blob([postmanJson], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${api.name.replace(/\s+/g, '_')}_Complete_Postman_Collection.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    // Visual feedback
                    const originalClass = icon.className;
                    const originalText = e.target.closest('.download-full-collection-btn').innerHTML;
                    icon.className = 'fas fa-check';
                    e.target.closest('.download-full-collection-btn').innerHTML = '<i class="fas fa-check me-1"></i>Downloaded!';
                    e.target.closest('.download-full-collection-btn').classList.remove('btn-light');
                    e.target.closest('.download-full-collection-btn').classList.add('btn-success');

                    setTimeout(() => {
                        e.target.closest('.download-full-collection-btn').innerHTML = originalText;
                        e.target.closest('.download-full-collection-btn').classList.remove('btn-success');
                        e.target.closest('.download-full-collection-btn').classList.add('btn-light');
                    }, 3000);
                });
            });

            document.querySelectorAll('.test-endpoint-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const apiFile = e.target.dataset.apiFile;
                    const endpointAction = e.target.dataset.endpointAction;
                    const api = apiEndpoints.find(a => a.file === apiFile);
                    const endpoint = api.endpoints.find(ep => ep.action === endpointAction);
                    const resultDiv = document.getElementById(`test-result-${api.file}-${endpoint.action}`);
                    const button = e.target;
                    const originalText = button.innerHTML;

                    // Show loading state
                    button.disabled = true;
                    button.innerHTML = '<span class="loading-spinner"></span> Testing...';
                    resultDiv.innerHTML = '<div class="alert alert-info"><span class="loading-spinner me-2"></span>Testing API endpoint...</div>';

                    let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}&secret_key=hospital-api-secret-2024`;

                    // Add test user parameter for dashboard API
                    if (api.file === 'dashboard.php') {
                        url += '&test_user_id=1'; // Test with user ID 1
                    }

                    try {
                        const response = await axios.get(url);
                        let resultHtml = '<pre class="code-viewer"><code>' + JSON.stringify(response.data, null, 2) + '</code></pre>';
                        if (response.data.success) {
                            resultDiv.innerHTML = `
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>Success
                                </div>
                                ${resultHtml}
                            `;
                        } else {
                            resultDiv.innerHTML = `
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>API returned failure
                                </div>
                                ${resultHtml}
                            `;
                        }
                    } catch (error) {
                        let errorData = error.response?.data || { error: error.message };
                        let errorHtml = '<pre class="code-viewer"><code>' + JSON.stringify(errorData, null, 2) + '</code></pre>';
                        resultDiv.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-times-circle me-2"></i>Request Error (${error.response?.status || 'Network Error'})
                            </div>
                            ${errorHtml}
                        `;
                    } finally {
                        // Restore button state
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }
                });
            });
        }

        async function testApi(api) {
            const resultBadge = document.getElementById(`test-result-badge-${api.file}`);
            resultBadge.className = 'badge float-end bg-warning';
            resultBadge.textContent = 'Testing...';

            const endpoint = api.endpoints.find(ep => ep.action === 'list');
            if (!endpoint) {
                resultBadge.className = 'badge float-end bg-danger';
                resultBadge.textContent = 'No "list" action';
                return;
            }

            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}&secret_key=hospital-api-secret-2024`;

            // Add user parameter for APIs that need user filtering
            if (['patient.php', 'dashboard.php', 'entry.php', 'doctor.php'].includes(api.file)) {
                if (api.file === 'dashboard.php') {
                    url += '&test_user_id=1'; // Dashboard uses test_user_id
                } else {
                    url += '&user_id=1'; // Other APIs use user_id
                }
            }

            try {
                const response = await axios.get(url);
                if (response.data.success) {
                    resultBadge.className = 'badge float-end bg-success';
                    resultBadge.textContent = 'Success';
                } else {
                    resultBadge.className = 'badge float-end bg-danger';
                    resultBadge.textContent = 'Failed';
                }
            } catch (error) {
                resultBadge.className = 'badge float-end bg-danger';
                resultBadge.textContent = 'Error';
            }
        }

        async function testAllApis() {
            for (const api of apiEndpoints) {
                await testApi(api);
            }
        }

        function generateCurlExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${window.location.origin}${url}&secret_key=hospital-api-secret-2024`;

            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }

            return `curl -X ${endpoint.method} "${fullUrl}"`;
        }

        function generateJsExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${url}&secret_key=hospital-api-secret-2024`;

            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }

            return `axios({
    method: '${endpoint.method}',
    url: '${fullUrl}'
}).then(response => {
    console.log(response.data);
});`;
        }

        function generatePhpExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${window.location.origin}${url}&secret_key=hospital-api-secret-2024`;

            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }

            const code = `<?php\n$url = "${fullUrl}";\n$response = file_get_contents($url);\n$data = json_decode($response, true);\nprint_r($data);\n?>`;
            return code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function generatePostmanExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}`;
            let fullUrl = `${window.location.origin}${url}`;

            // Build query parameters
            let queryParams = [
                {
                    "key": "action",
                    "value": endpoint.action,
                    "description": "API action to perform"
                },
                {
                    "key": "secret_key",
                    "value": "hospital-api-secret-2024",
                    "description": "API secret key for authentication"
                }
            ];

            // Add endpoint-specific parameters
            if (endpoint.params) {
                endpoint.params.forEach(param => {
                    queryParams.push({
                        "key": param,
                        "value": param === 'id' ? "1" : (param.includes('user') ? "1" : "example_value"),
                        "description": `${param.charAt(0).toUpperCase() + param.slice(1)} parameter`
                    });
                });
            }

            // Add special parameters for specific APIs
            if (api.file === 'dashboard.php') {
                queryParams.push({
                    "key": "test_user_id",
                    "value": "1",
                    "description": "Test user ID for dashboard API"
                });
            } else if (['patient.php', 'entry.php', 'doctor.php'].includes(api.file)) {
                queryParams.push({
                    "key": "user_id",
                    "value": "1",
                    "description": "User ID for filtering data"
                });
            }

            // Generate request body for POST requests
            let requestBody = null;
            if (endpoint.method === 'POST') {
                if (endpoint.action === 'save') {
                    if (api.file === 'user.php') {
                        requestBody = {
                            "mode": "raw",
                            "raw": JSON.stringify({
                                "name": "John Doe",
                                "email": "john@example.com",
                                "username": "johndoe",
                                "password": "password123",
                                "role": "user"
                            }, null, 2),
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        };
                    } else if (api.file === 'patient.php') {
                        requestBody = {
                            "mode": "raw",
                            "raw": JSON.stringify({
                                "name": "Jane Smith",
                                "age": "30",
                                "gender": "Female",
                                "phone": "1234567890",
                                "address": "123 Main St",
                                "user_id": "1"
                            }, null, 2),
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        };
                    } else if (api.file === 'doctor.php') {
                        requestBody = {
                            "mode": "raw",
                            "raw": JSON.stringify({
                                "name": "Dr. Smith",
                                "specialization": "Cardiology",
                                "phone": "1234567890",
                                "email": "dr.smith@example.com",
                                "hospital": "General Hospital"
                            }, null, 2),
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        };
                    } else if (api.file === 'test.php') {
                        requestBody = {
                            "mode": "raw",
                            "raw": JSON.stringify({
                                "name": "Complete Blood Count (CBC)",
                                "category_id": "1",
                                "main_category_id": "1",
                                "price": "150.00",
                                "unit": "cells/Î¼L",
                                "specimen": "Blood (EDTA)",
                                "default_result": "Normal blood count parameters",
                                "reference_range": "See individual parameters",
                                "min": "4000",
                                "max": "11000",
                                "description": "Complete blood count with differential including RBC, WBC, platelets, hemoglobin, hematocrit",
                                "min_male": "4500",
                                "max_male": "11000",
                                "min_female": "4000",
                                "max_female": "10500",
                                "min_child": "5000",
                                "max_child": "12000",
                                "sub_heading": "0",
                                "test_code": "CBC001",
                                "method": "Automated hematology analyzer",
                                "print_new_page": "0",
                                "shortcut": "CBC"
                            }, null, 2),
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        };
                    } else {
                        requestBody = {
                            "mode": "raw",
                            "raw": JSON.stringify({
                                "name": "Example Name",
                                "description": "Example Description"
                            }, null, 2),
                            "options": {
                                "raw": {
                                    "language": "json"
                                }
                            }
                        };
                    }
                } else if (endpoint.action === 'delete') {
                    requestBody = {
                        "mode": "formdata",
                        "formdata": [
                            {
                                "key": "id",
                                "value": "1",
                                "description": "ID of the record to delete",
                                "type": "text"
                            }
                        ]
                    };
                }
            }

            // Create Postman collection structure
            const postmanCollection = {
                "info": {
                    "name": `${api.name} API - ${endpoint.action}`,
                    "description": `${api.description}\\n\\nEndpoint: ${endpoint.description}`,
                    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
                },
                "item": [
                    {
                        "name": `${endpoint.action} - ${api.name}`,
                        "request": {
                            "method": endpoint.method,
                            "header": [
                                {
                                    "key": "Content-Type",
                                    "value": "application/json",
                                    "description": "Content type for JSON requests"
                                },
                                {
                                    "key": "Accept",
                                    "value": "application/json",
                                    "description": "Accept JSON responses"
                                }
                            ],
                            "url": {
                                "raw": fullUrl,
                                "protocol": window.location.protocol.replace(':', ''),
                                "host": window.location.hostname.split('.'),
                                "port": window.location.port || (window.location.protocol === 'https:' ? '443' : '80'),
                                "path": url.split('?')[0].split('/').filter(p => p),
                                "query": queryParams
                            },
                            "description": `${endpoint.description}\\n\\nAPI File: ${api.file}\\nMethod: ${endpoint.method}`
                        },
                        "response": [
                            {
                                "name": "Success Response Example",
                                "originalRequest": {
                                    "method": endpoint.method,
                                    "header": [],
                                    "url": {
                                        "raw": fullUrl,
                                        "protocol": window.location.protocol.replace(':', ''),
                                        "host": window.location.hostname.split('.'),
                                        "path": url.split('?')[0].split('/').filter(p => p),
                                        "query": queryParams
                                    }
                                },
                                "status": "OK",
                                "code": 200,
                                "_postman_previewlanguage": "json",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "cookie": [],
                                "body": JSON.stringify({
                                    "success": true,
                                    "message": "Operation completed successfully",
                                    "data": endpoint.action === 'list' ? [] : {}
                                }, null, 2)
                            }
                        ]
                    }
                ],
                "variable": [
                    {
                        "key": "base_url",
                        "value": window.location.origin,
                        "description": "Base URL for the API"
                    },
                    {
                        "key": "api_secret",
                        "value": "hospital-api-secret-2024",
                        "description": "API secret key"
                    }
                ]
            };

            // Add body to request if it's a POST request
            if (requestBody) {
                postmanCollection.item[0].request.body = requestBody;
            }

            return JSON.stringify(postmanCollection, null, 2);
        }

        function generateFullPostmanCollection(api) {
            const items = api.endpoints.map(endpoint => {
                let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}`;
                let fullUrl = `${window.location.origin}${url}`;

                // Build query parameters
                let queryParams = [
                    {
                        "key": "action",
                        "value": endpoint.action,
                        "description": "API action to perform"
                    },
                    {
                        "key": "secret_key",
                        "value": "{{api_secret}}",
                        "description": "API secret key for authentication"
                    }
                ];

                // Add endpoint-specific parameters
                if (endpoint.params) {
                    endpoint.params.forEach(param => {
                        queryParams.push({
                            "key": param,
                            "value": param === 'id' ? "{{record_id}}" : (param.includes('user') ? "{{user_id}}" : "{{" + param + "}}"),
                            "description": `${param.charAt(0).toUpperCase() + param.slice(1)} parameter`
                        });
                    });
                }

                // Add special parameters for specific APIs
                if (api.file === 'dashboard.php') {
                    queryParams.push({
                        "key": "test_user_id",
                        "value": "{{user_id}}",
                        "description": "Test user ID for dashboard API"
                    });
                } else if (['patient.php', 'entry.php', 'doctor.php'].includes(api.file)) {
                    queryParams.push({
                        "key": "user_id",
                        "value": "{{user_id}}",
                        "description": "User ID for filtering data"
                    });
                }

                // Generate request body for POST requests
                let requestBody = null;
                if (endpoint.method === 'POST') {
                    if (endpoint.action === 'save') {
                        if (api.file === 'user.php') {
                            requestBody = {
                                "mode": "raw",
                                "raw": JSON.stringify({
                                    "name": "{{user_name}}",
                                    "email": "{{user_email}}",
                                    "username": "{{username}}",
                                    "password": "{{password}}",
                                    "role": "{{user_role}}"
                                }, null, 2),
                                "options": {
                                    "raw": {
                                        "language": "json"
                                    }
                                }
                            };
                        } else if (api.file === 'patient.php') {
                            requestBody = {
                                "mode": "raw",
                                "raw": JSON.stringify({
                                    "name": "{{patient_name}}",
                                    "age": "{{patient_age}}",
                                    "gender": "{{patient_gender}}",
                                    "phone": "{{patient_phone}}",
                                    "address": "{{patient_address}}",
                                    "user_id": "{{user_id}}"
                                }, null, 2),
                                "options": {
                                    "raw": {
                                        "language": "json"
                                    }
                                }
                            };
                        } else if (api.file === 'doctor.php') {
                            requestBody = {
                                "mode": "raw",
                                "raw": JSON.stringify({
                                    "name": "{{doctor_name}}",
                                    "specialization": "{{specialization}}",
                                    "phone": "{{doctor_phone}}",
                                    "email": "{{doctor_email}}",
                                    "hospital": "{{hospital_name}}"
                                }, null, 2),
                                "options": {
                                    "raw": {
                                        "language": "json"
                                    }
                                }
                            };
                        } else if (api.file === 'test.php') {
                            requestBody = {
                                "mode": "raw",
                                "raw": JSON.stringify({
                                    "name": "{{test_name}}",
                                    "category_id": "{{category_id}}",
                                    "main_category_id": "{{main_category_id}}",
                                    "price": "{{test_price}}",
                                    "unit": "{{measurement_unit}}",
                                    "specimen": "{{specimen_type}}",
                                    "default_result": "{{default_result_text}}",
                                    "reference_range": "{{reference_range_text}}",
                                    "min": "{{min_normal_value}}",
                                    "max": "{{max_normal_value}}",
                                    "description": "{{test_description}}",
                                    "min_male": "{{min_male_value}}",
                                    "max_male": "{{max_male_value}}",
                                    "min_female": "{{min_female_value}}",
                                    "max_female": "{{max_female_value}}",
                                    "min_child": "{{min_child_value}}",
                                    "max_child": "{{max_child_value}}",
                                    "sub_heading": "{{is_sub_heading}}",
                                    "test_code": "{{test_code}}",
                                    "method": "{{testing_method}}",
                                    "print_new_page": "{{print_new_page}}",
                                    "shortcut": "{{keyboard_shortcut}}"
                                }, null, 2),
                                "options": {
                                    "raw": {
                                        "language": "json"
                                    }
                                }
                            };
                        } else {
                            requestBody = {
                                "mode": "raw",
                                "raw": JSON.stringify({
                                    "name": "{{item_name}}",
                                    "description": "{{item_description}}"
                                }, null, 2),
                                "options": {
                                    "raw": {
                                        "language": "json"
                                    }
                                }
                            };
                        }
                    } else if (endpoint.action === 'delete') {
                        requestBody = {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "id",
                                    "value": "{{record_id}}",
                                    "description": "ID of the record to delete",
                                    "type": "text"
                                }
                            ]
                        };
                    }
                }

                const item = {
                    "name": `${endpoint.action.charAt(0).toUpperCase() + endpoint.action.slice(1)} ${api.name}`,
                    "request": {
                        "method": endpoint.method,
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json",
                                "description": "Content type for JSON requests"
                            },
                            {
                                "key": "Accept",
                                "value": "application/json",
                                "description": "Accept JSON responses"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}" + url,
                            "host": ["{{base_url}}"],
                            "path": url.split('?')[0].split('/').filter(p => p),
                            "query": queryParams
                        },
                        "description": `${endpoint.description}\\n\\nMethod: ${endpoint.method}\\nAction: ${endpoint.action}`
                    }
                };

                if (requestBody) {
                    item.request.body = requestBody;
                }

                return item;
            });

            return {
                "info": {
                    "name": `${api.name} API - Complete Collection`,
                    "description": `Complete Postman collection for ${api.name} API\\n\\n${api.description}\\n\\nThis collection includes all available endpoints for the ${api.name} API with example requests and responses.`,
                    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
                },
                "item": items,
                "variable": [
                    {
                        "key": "base_url",
                        "value": window.location.origin,
                        "description": "Base URL for the API"
                    },
                    {
                        "key": "api_secret",
                        "value": "hospital-api-secret-2024",
                        "description": "API secret key for authentication"
                    },
                    {
                        "key": "user_id",
                        "value": "1",
                        "description": "User ID for API requests"
                    },
                    {
                        "key": "record_id",
                        "value": "1",
                        "description": "Record ID for get/update/delete operations"
                    }
                ]
            };
        }

        testAllBtn.addEventListener('click', testAllApis);

        // Handle URL hash navigation
        function handleHashNavigation() {
            const hash = window.location.hash.substring(1); // Remove the # symbol
            if (hash) {
                const targetApi = apiEndpoints.find(api => api.file === hash);
                if (targetApi) {
                    renderApiDocumentation(targetApi);
                    updateActiveNavigation(hash);
                    // Update page title
                    document.title = `${targetApi.name} API - API Documentation & Tester`;
                    return;
                }
            }
            // Default to first API if no valid hash
            if (apiEndpoints.length > 0) {
                const firstApi = apiEndpoints[0];
                renderApiDocumentation(firstApi);
                updateActiveNavigation(firstApi.file);
                // Update URL without triggering hashchange
                history.replaceState(null, null, `#${firstApi.file}`);
                document.title = `${firstApi.name} API - API Documentation & Tester`;
            }
        }

        // Update active navigation state
        function updateActiveNavigation(activeFile) {
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`a[href="#${activeFile}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        // Listen for hash changes
        window.addEventListener('hashchange', handleHashNavigation);

        // Mobile Sidebar Functionality
        function initializeMobileSidebar() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebarClose = document.getElementById('sidebarClose');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function showSidebar() {
                sidebar.classList.add('show');
                sidebarOverlay.style.display = 'block';
                setTimeout(() => sidebarOverlay.classList.add('show'), 10);
                document.body.style.overflow = 'hidden';
            }

            function hideSidebar() {
                sidebar.classList.remove('show');
                sidebarOverlay.classList.remove('show');
                setTimeout(() => {
                    sidebarOverlay.style.display = 'none';
                    document.body.style.overflow = '';
                }, 300);
            }

            // Event listeners
            sidebarToggle.addEventListener('click', showSidebar);
            sidebarClose.addEventListener('click', hideSidebar);
            sidebarOverlay.addEventListener('click', hideSidebar);

            // Close sidebar when clicking on API items on mobile
            document.addEventListener('click', (e) => {
                if (e.target.closest('.list-group-item') && window.innerWidth <= 768) {
                    setTimeout(hideSidebar, 300);
                }
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    hideSidebar();
                }
            });

            // Handle escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sidebar.classList.contains('show')) {
                    hideSidebar();
                }
            });
        }

        // Enhanced scroll handling for mobile
        function handleMobileScroll() {
            let lastScrollTop = 0;
            const mobileHeader = document.querySelector('.mobile-header');

            if (!mobileHeader) return;

            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    // Scrolling down
                    mobileHeader.style.transform = 'translateY(-100%)';
                } else {
                    // Scrolling up
                    mobileHeader.style.transform = 'translateY(0)';
                }

                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, { passive: true });
        }

        // Touch gesture support for sidebar
        function initializeTouchGestures() {
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            document.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            }, { passive: true });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
            }, { passive: true });

            document.addEventListener('touchend', () => {
                if (!isDragging) return;
                isDragging = false;

                const diffX = currentX - startX;
                const sidebar = document.getElementById('sidebar');

                // Swipe right to open sidebar (from left edge)
                if (diffX > 50 && startX < 50 && window.innerWidth <= 768) {
                    sidebar.classList.add('show');
                    document.getElementById('sidebarOverlay').style.display = 'block';
                    setTimeout(() => document.getElementById('sidebarOverlay').classList.add('show'), 10);
                }

                // Swipe left to close sidebar
                if (diffX < -50 && sidebar.classList.contains('show')) {
                    sidebar.classList.remove('show');
                    const overlay = document.getElementById('sidebarOverlay');
                    overlay.classList.remove('show');
                    setTimeout(() => overlay.style.display = 'none', 300);
                }
            }, { passive: true });
        }

        // Initialize everything
        function initializeApp() {
            renderApiList();
            handleHashNavigation();
            initializeMobileSidebar();
            handleMobileScroll();
            initializeTouchGestures();

            // Add loading state
            document.body.classList.add('loaded');
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>

</html>
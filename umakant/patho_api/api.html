<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patho API Testing Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .api-card { margin-bottom: 20px; transition: all 0.3s ease; }
        .api-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .method-badge { font-size: 0.8em; margin-right: 5px; }
        .response-container { max-height: 400px; overflow-y: auto; }
        .endpoint-url { font-family: 'Courier New', monospace; background: #e9ecef; padding: 5px 10px; border-radius: 4px; }
        .auth-section { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .test-form { background: white; border-radius: 8px; padding: 20px; margin: 10px 0; }
        .loading { display: none; }
        .result-success { background: #d1edff; border-left: 4px solid #0dcaf0; }
        .result-error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .result-warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .nav-pills .nav-link.active { background-color: #0d6efd; }
        .api-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1><i class="fas fa-code text-primary"></i> Patho API Testing Interface</h1>
                    <div>
                        <button class="btn btn-outline-primary" onclick="loadAllApis()">
                            <i class="fas fa-sync-alt"></i> Refresh APIs
                        </button>
                        <button class="btn btn-outline-success" onclick="testAllEndpoints()">
                            <i class="fas fa-play"></i> Test All
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section">
            <h5><i class="fas fa-key text-warning"></i> Authentication Settings</h5>
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">API Key (Header: X-Api-Key)</label>
                    <input type="text" id="apiKey" class="form-control" placeholder="your-api-key">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Secret Key (Param: secret_key)</label>
                    <input type="text" id="secretKey" class="form-control" placeholder="your-secret-key">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Base URL</label>
                    <input type="text" id="baseUrl" class="form-control" value="/umakant/patho_api/">
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-pills mb-4" id="apiTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="endpoints-tab" data-bs-toggle="pill" data-bs-target="#endpoints" type="button" role="tab">
                    <i class="fas fa-list"></i> All Endpoints
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="testing-tab" data-bs-toggle="pill" data-bs-target="#testing" type="button" role="tab">
                    <i class="fas fa-flask"></i> API Testing
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="docs-tab" data-bs-toggle="pill" data-bs-target="#docs" type="button" role="tab">
                    <i class="fas fa-book"></i> Documentation
                </button>
            </li>
        </ul>

        <div class="tab-content" id="apiTabContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-code fa-2x text-primary mb-2"></i>
                                <h5 id="totalApis">0</h5>
                                <p class="card-text">Total APIs</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                <h5 id="workingApis">0</h5>
                                <p class="card-text">Working APIs</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                                <h5 id="errorApis">0</h5>
                                <p class="card-text">APIs with Errors</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-clock fa-2x text-info mb-2"></i>
                                <h5 id="lastTested">Never</h5>
                                <p class="card-text">Last Tested</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h4>API Status Overview</h4>
                    <div id="apiStatusOverview"></div>
                </div>
            </div>

            <!-- All Endpoints Tab -->
            <div class="tab-pane fade" id="endpoints" role="tabpanel">
                <div id="apiList" class="api-grid"></div>
            </div>

            <!-- API Testing Tab -->
            <div class="tab-pane fade" id="testing" role="tabpanel">
                <div class="test-form">
                    <h4><i class="fas fa-flask"></i> Manual API Testing</h4>
                    
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Method</label>
                            <select id="testMethod" class="form-select">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        <div class="col-md-9">
                            <label class="form-label">Endpoint URL</label>
                            <input type="text" id="testUrl" class="form-control" placeholder="/umakant/patho_api/doctor.php?action=list">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Request Headers (JSON)</label>
                            <textarea id="testHeaders" class="form-control" rows="4" placeholder='{"X-Api-Key": "your-key"}'></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Request Body (JSON)</label>
                            <textarea id="testBody" class="form-control" rows="4" placeholder='{"name": "Test Doctor", "email": "test@example.com"}'></textarea>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="executeManualTest()">
                        <i class="fas fa-play"></i> Execute Test
                    </button>

                    <div id="manualTestResult" class="mt-3"></div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div class="tab-pane fade" id="docs" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h4><i class="fas fa-book"></i> API Documentation</h4>
                        
                        <h5>Authentication Methods</h5>
                        <ul>
                            <li><strong>API Key Header:</strong> <code>X-Api-Key: your-api-key</code></li>
                            <li><strong>Secret Parameter:</strong> <code>secret_key=your-secret-key</code></li>
                            <li><strong>Session-based:</strong> Login with username/password</li>
                            <li><strong>Bearer Token:</strong> <code>Authorization: Bearer your-token</code></li>
                        </ul>

                        <h5>Common Actions</h5>
                        <ul>
                            <li><strong>list:</strong> Get all records (GET /endpoint.php?action=list)</li>
                            <li><strong>get:</strong> Get single record (GET /endpoint.php?action=get&id=123)</li>
                            <li><strong>save:</strong> Create/Update record (POST /endpoint.php?action=save)</li>
                            <li><strong>delete:</strong> Delete record (POST /endpoint.php?action=delete&id=123)</li>
                        </ul>

                        <h5>Available Endpoints</h5>
                        <div id="endpointsDocs"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // API endpoints configuration
        const apiEndpoints = [
            {
                name: 'Doctor API',
                file: 'doctor.php',
                description: 'Manage doctors and their information',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { name: 'Dr. John Doe', email: 'john@hospital.com', qualification: 'MBBS', specialization: 'Cardiology' }
            },
            {
                name: 'Patient API',
                file: 'patient.php',
                description: 'Patient management operations',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { name: 'John Patient', age: 30, gender: 'Male', phone: '1234567890' }
            },
            {
                name: 'Test API',
                file: 'test.php',
                description: 'Laboratory test management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { test_name: 'Blood Test', category_id: 1, rate: 500, description: 'Complete blood count' }
            },
            {
                name: 'Test Categories API',
                file: 'test_category.php',
                description: 'Test category management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { name: 'Blood Tests', description: 'All blood related tests' }
            },
            {
                name: 'Entry API',
                file: 'entry.php',
                description: 'Test entry management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { patient_id: 1, test_id: 1, result: 'Normal', date: '2025-09-07' }
            },
            {
                name: 'User API',
                file: 'user.php',
                description: 'User account management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { username: 'testuser', email: 'test@example.com', role: 'user' }
            },
            {
                name: 'Owner API',
                file: 'owner.php',
                description: 'Hospital owner management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { name: 'Hospital Owner', email: 'owner@hospital.com', phone: '9876543210' }
            },
            {
                name: 'Plans API',
                file: 'plans.php',
                description: 'Pricing plans management',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { name: 'Basic Plan', price: 1000, duration: 30, description: 'Basic features' }
            },
            {
                name: 'Notice API',
                file: 'notice.php',
                description: 'Notice and announcements',
                actions: ['list', 'get', 'save', 'delete'],
                methods: ['GET', 'POST', 'PUT', 'DELETE'],
                sampleData: { title: 'Important Notice', content: 'This is a test notice', type: 'info' }
            },
            {
                name: 'Reports API',
                file: 'reports.php',
                description: 'Generate various reports',
                actions: ['list', 'get', 'generate'],
                methods: ['GET', 'POST'],
                sampleData: { report_type: 'daily', date_from: '2025-09-01', date_to: '2025-09-07' }
            },
            {
                name: 'Login API',
                file: 'login.php',
                description: 'Authentication endpoint',
                actions: ['login', 'logout', 'verify'],
                methods: ['POST'],
                sampleData: { username: 'admin', password: 'password' }
            },
            {
                name: 'Zip Uploads API',
                file: 'zip_uploads.php',
                description: 'File upload management',
                actions: ['list', 'upload', 'download', 'delete'],
                methods: ['GET', 'POST', 'DELETE'],
                sampleData: { file: 'test-file.zip', description: 'Test upload' }
            }
        ];

        let apiResults = {};

        function loadAllApis() {
            const apiList = document.getElementById('apiList');
            apiList.innerHTML = '';

            apiEndpoints.forEach((api, index) => {
                const card = createApiCard(api, index);
                apiList.appendChild(card);
            });

            updateOverview();
            generateDocumentation();
        }

        function createApiCard(api, index) {
            const card = document.createElement('div');
            card.className = 'card api-card';
            card.innerHTML = `
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">${api.name}</h5>
                    <div>
                        <span class="badge bg-primary method-badge">${api.methods.join(', ')}</span>
                        <button class="btn btn-sm btn-outline-primary" onclick="testSingleApi(${index})">
                            <i class="fas fa-play"></i> Test
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="card-text">${api.description}</p>
                    <div class="endpoint-url mb-2">${getBaseUrl()}${api.file}</div>
                    <div class="mb-2">
                        <strong>Actions:</strong> 
                        ${api.actions.map(action => `<span class="badge bg-secondary me-1">${action}</span>`).join('')}
                    </div>
                    <div id="result-${index}" class="mt-3"></div>
                </div>
            `;
            return card;
        }

        async function testSingleApi(index) {
            const api = apiEndpoints[index];
            const resultDiv = document.getElementById(`result-${index}`);
            
            resultDiv.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Testing...</div>';
            
            try {
                // Test the list action for each API
                const url = `${getBaseUrl()}${api.file}?action=list`;
                const headers = getHeaders();
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers
                });
                
                const data = await response.json();
                const isSuccess = response.ok && data.success !== false;
                
                apiResults[api.file] = {
                    status: isSuccess ? 'success' : 'error',
                    response: data,
                    timestamp: new Date().toISOString()
                };
                
                resultDiv.innerHTML = `
                    <div class="p-2 rounded ${isSuccess ? 'result-success' : 'result-error'}">
                        <strong>${isSuccess ? '✓ Success' : '✗ Error'}</strong>
                        <small class="d-block">Status: ${response.status}</small>
                        <details class="mt-2">
                            <summary>Response Details</summary>
                            <pre class="mt-2 p-2 bg-light rounded"><code>${JSON.stringify(data, null, 2)}</code></pre>
                        </details>
                    </div>
                `;
                
            } catch (error) {
                apiResults[api.file] = {
                    status: 'error',
                    error: error.message,
                    timestamp: new Date().toISOString()
                };
                
                resultDiv.innerHTML = `
                    <div class="p-2 rounded result-error">
                        <strong>✗ Error</strong>
                        <small class="d-block">${error.message}</small>
                    </div>
                `;
            }
            
            updateOverview();
        }

        async function testAllEndpoints() {
            for (let i = 0; i < apiEndpoints.length; i++) {
                await testSingleApi(i);
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function executeManualTest() {
            const method = document.getElementById('testMethod').value;
            const url = document.getElementById('testUrl').value;
            const headersText = document.getElementById('testHeaders').value;
            const bodyText = document.getElementById('testBody').value;
            const resultDiv = document.getElementById('manualTestResult');
            
            try {
                let headers = getHeaders();
                if (headersText.trim()) {
                    const customHeaders = JSON.parse(headersText);
                    headers = { ...headers, ...customHeaders };
                }
                
                const options = {
                    method: method,
                    headers: headers
                };
                
                if (method !== 'GET' && bodyText.trim()) {
                    if (headers['Content-Type']?.includes('application/json')) {
                        options.body = bodyText;
                    } else {
                        options.body = new URLSearchParams(JSON.parse(bodyText));
                    }
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="p-3 rounded ${response.ok ? 'result-success' : 'result-error'}">
                        <h5>Response (${response.status} ${response.statusText})</h5>
                        <pre class="p-2 bg-light rounded"><code>${JSON.stringify(data, null, 2)}</code></pre>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="p-3 rounded result-error">
                        <h5>Error</h5>
                        <pre class="p-2 bg-light rounded"><code>${error.message}</code></pre>
                    </div>
                `;
            }
        }

        function updateOverview() {
            const total = apiEndpoints.length;
            const working = Object.values(apiResults).filter(r => r.status === 'success').length;
            const errors = Object.values(apiResults).filter(r => r.status === 'error').length;
            
            document.getElementById('totalApis').textContent = total;
            document.getElementById('workingApis').textContent = working;
            document.getElementById('errorApis').textContent = errors;
            document.getElementById('lastTested').textContent = new Date().toLocaleTimeString();
            
            // Generate status overview
            const statusOverview = document.getElementById('apiStatusOverview');
            statusOverview.innerHTML = apiEndpoints.map((api, index) => {
                const result = apiResults[api.file];
                const status = result ? result.status : 'untested';
                const icon = status === 'success' ? '✓' : status === 'error' ? '✗' : '○';
                const color = status === 'success' ? 'success' : status === 'error' ? 'danger' : 'secondary';
                
                return `
                    <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                        <span>${api.name}</span>
                        <span class="badge bg-${color}">${icon} ${status}</span>
                    </div>
                `;
            }).join('');
        }

        function generateDocumentation() {
            const docsDiv = document.getElementById('endpointsDocs');
            docsDiv.innerHTML = apiEndpoints.map(api => `
                <div class="mb-3 p-3 border rounded">
                    <h6>${api.name}</h6>
                    <p>${api.description}</p>
                    <div class="endpoint-url">${getBaseUrl()}${api.file}</div>
                    <div class="mt-2">
                        <strong>Methods:</strong> ${api.methods.join(', ')}<br>
                        <strong>Actions:</strong> ${api.actions.join(', ')}<br>
                        <strong>Sample Data:</strong> <code>${JSON.stringify(api.sampleData, null, 2)}</code>
                    </div>
                </div>
            `).join('');
        }

        function getBaseUrl() {
            return document.getElementById('baseUrl').value || '/umakant/patho_api/';
        }

        function getHeaders() {
            const headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            };
            
            const apiKey = document.getElementById('apiKey').value;
            if (apiKey) {
                headers['X-Api-Key'] = apiKey;
            }
            
            return headers;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadAllApis();
        });
    </script>
</body>
</html>

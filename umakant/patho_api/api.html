<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation & Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .sidebar {
            width: 280px;
            background: #fff;
            border-right: 1px solid #dee2e6;
            padding: 20px;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
        }
        .main-content {
            margin-left: 280px;
            padding: 20px;
        }
        .api-list .list-group-item { cursor: pointer; }
        .code-viewer { background: #212529; color: #fff; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; }

        @media (max-width: 768px) {
            .sidebar {
                position: static;
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="d-flex flex-column flex-md-row">
        <div class="sidebar">
            <h4 class="mb-4">APIs</h4>
            <div class="d-grid gap-2">
                <button id="test-all-btn" class="btn btn-primary mb-3">Test All APIs</button>
            </div>
            <div id="api-list" class="list-group"></div>
        </div>
        <div class="main-content">
            <div class="container-fluid">
                <div id="api-documentation"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const apiEndpoints = [
            {
                name: 'Users',
                file: 'user.php',
                description: 'API for managing users.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all users.' },
                    { action: 'get', method: 'GET', description: 'Get a single user by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a user.' },
                    { action: 'delete', method: 'POST', description: 'Delete a user by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Doctors',
                file: 'doctor.php',
                description: 'API for managing doctors.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all doctors.' },
                    { action: 'get', method: 'GET', description: 'Get a single doctor by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a doctor.' },
                    { action: 'specializations', method: 'GET', description: 'Get list of available specializations.' },
                    { action: 'hospitals', method: 'GET', description: 'Get list of available hospitals.' },
                    { action: 'delete', method: 'POST', description: 'Delete a doctor by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Patients',
                file: 'patient.php',
                description: 'API for managing patients.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all patients.' },
                    { action: 'get', method: 'GET', description: 'Get a single patient by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a patient.' },
                    { action: 'delete', method: 'POST', description: 'Delete a patient by ID.', params: ['id'] },
                    { action: 'stats', method: 'GET', description: 'Get patient statistics.' }
                ]
            },
            {
                name: 'Tests',
                file: 'test.php',
                description: 'API for managing tests.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all tests.' },
                    { action: 'get', method: 'GET', description: 'Get a single test by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a test.' },
                    { action: 'delete', method: 'POST', description: 'Delete a test by ID.', params: ['id'] },
                    { action: 'stats', method: 'GET', description: 'Get test statistics.' }
                ]
            },
            {
                name: 'Test Categories',
                file: 'test_category.php',
                description: 'API for managing test categories.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all test categories.' },
                    { action: 'get', method: 'GET', description: 'Get a single test category by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a test category.' },
                    { action: 'delete', method: 'POST', description: 'Delete a test category by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Main Test Categories',
                file: 'main_test_category.php',
                description: 'API for managing main test categories (used by main-test-category.php).',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all main test categories.' },
                    { action: 'get', method: 'GET', description: 'Get a single main category by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a main test category.' },
                    { action: 'delete', method: 'POST', description: 'Delete a main test category by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Entries',
                file: 'entry.php',
                description: 'API for managing test entries.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all test entries.' },
                    { action: 'get', method: 'GET', description: 'Get a single test entry by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a test entry.' },
                    { action: 'delete', method: 'POST', description: 'Delete a test entry by ID.', params: ['id'] },
                    { action: 'stats', method: 'GET', description: 'Get test entry statistics.' },
                    { action: 'add_test', method: 'POST', description: 'Add a test to an entry.' },
                    { action: 'remove_test', method: 'POST', description: 'Remove a test from an entry.' },
                    { action: 'get_tests', method: 'GET', description: 'Get all tests for an entry.', params: ['entry_id'] },
                    { action: 'update_test_result', method: 'POST', description: 'Update a test result.' }
                ]
            },
            {
                name: 'Notices',
                file: 'notice.php',
                description: 'API for managing notices.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all notices.' },
                    { action: 'get', method: 'GET', description: 'Get a single notice by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update a notice.' },
                    { action: 'delete', method: 'POST', description: 'Delete a notice by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Owners',
                file: 'owner.php',
                description: 'API for managing owners.',
                endpoints: [
                    { action: 'list', method: 'GET', description: 'Get all owners.' },
                    { action: 'get', method: 'GET', description: 'Get a single owner by ID.', params: ['id'] },
                    { action: 'save', method: 'POST', description: 'Create or update an owner.' },
                    { action: 'delete', method: 'POST', description: 'Delete an owner by ID.', params: ['id'] }
                ]
            },
            {
                name: 'Dashboard',
                file: 'dashboard.php',
                description: 'Comprehensive dashboard API for pathology management system. Shows user-specific data based on authentication.',
                endpoints: [
                    { action: 'overview', method: 'GET', description: 'Get complete dashboard overview with counts, stats, and metrics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'stats', method: 'GET', description: 'Get detailed statistics (daily, weekly, monthly, yearly) for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'recent_activities', method: 'GET', description: 'Get recent activities and events for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'charts_data', method: 'GET', description: 'Get data for dashboard charts and graphs for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'quick_stats', method: 'GET', description: 'Get quick statistics for today vs yesterday for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'revenue_stats', method: 'GET', description: 'Get comprehensive revenue statistics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'test_performance', method: 'GET', description: 'Get test performance metrics and analytics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'patient_demographics', method: 'GET', description: 'Get patient demographic breakdowns for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'monthly_trends', method: 'GET', description: 'Get monthly trend analysis for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'top_tests', method: 'GET', description: 'Get most popular and profitable tests for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'doctor_performance', method: 'GET', description: 'Get doctor performance metrics for current user.', params: ['test_user_id', 'test_username'] },
                    { action: 'alerts', method: 'GET', description: 'Get system alerts and notifications for current user.', params: ['test_user_id', 'test_username'] }
                ]
            },
        ];

        const apiList = document.getElementById('api-list');
        const apiDocumentation = document.getElementById('api-documentation');
        const testAllBtn = document.getElementById('test-all-btn');

        function renderApiList() {
            apiList.innerHTML = '';
            apiEndpoints.forEach(api => {
                const a = document.createElement('a');
                a.href = `#${api.file}`;
                a.className = 'list-group-item list-group-item-action';
                a.innerHTML = `${api.name} <span id="test-result-badge-${api.file}" class="badge float-end"></span>`;
                a.onclick = () => renderApiDocumentation(api);
                apiList.appendChild(a);
            });
        }

        function renderApiDocumentation(api) {
            let endpointsHtml = '';
            api.endpoints.forEach(endpoint => {
                endpointsHtml += `
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between">
                            <h5>${endpoint.action}</h5>
                            <button class="btn btn-sm btn-primary test-endpoint-btn" data-api-file="${api.file}" data-endpoint-action="${endpoint.action}">Test</button>
                        </div>
                        <div class="card-body">
                            <p>${endpoint.description}</p>
                            <p><strong>Method:</strong> ${endpoint.method}</p>
                            <p><strong>URL:</strong> <code>/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}</code></p>
                            <h6>Code Examples</h6>
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#curl-${api.file}-${endpoint.action}" type="button" role="tab">cURL</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#js-${api.file}-${endpoint.action}" type="button" role="tab">JavaScript</button></li>
                                <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#php-${api.file}-${endpoint.action}" type="button" role="tab">PHP</button></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="curl-${api.file}-${endpoint.action}" role="tabpanel">
                                    <pre class="code-viewer"><code>${generateCurlExample(api, endpoint)}</code></pre>
                                </div>
                                <div class="tab-pane fade" id="js-${api.file}-${endpoint.action}" role="tabpanel">
                                    <pre class="code-viewer"><code>${generateJsExample(api, endpoint)}</code></pre>
                                </div>
                                <div class="tab-pane fade" id="php-${api.file}-${endpoint.action}" role="tabpanel">
                                    <pre class="code-viewer"><code>${generatePhpExample(api, endpoint)}</code></pre>
                                </div>
                            </div>
                            <div id="test-result-${api.file}-${endpoint.action}" class="mt-3"></div>
                        </div>
                    </div>
                `;
            });

            apiDocumentation.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">${api.name}</h2>
                    </div>
                    <div class="card-body">
                        <p class="card-text">${api.description}</p>
                        ${endpointsHtml}
                    </div>
                </div>
            `;

            document.querySelectorAll('.test-endpoint-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const apiFile = e.target.dataset.apiFile;
                    const endpointAction = e.target.dataset.endpointAction;
                    const api = apiEndpoints.find(a => a.file === apiFile);
                    const endpoint = api.endpoints.find(ep => ep.action === endpointAction);
                    const resultDiv = document.getElementById(`test-result-${api.file}-${endpoint.action}`);
                    resultDiv.innerHTML = '<span class="badge bg-warning">Testing...</span>';

                    let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}&secret_key=hospital-api-secret-2024`;
                    
                    // Add test user parameter for dashboard API
                    if (api.file === 'dashboard.php') {
                        url += '&test_user_id=1'; // Test with user ID 1
                    }

                    try {
                        const response = await axios.get(url);
                        let resultHtml = '<pre class="code-viewer"><code>' + JSON.stringify(response.data, null, 2) + '</code></pre>';
                        if (response.data.success) {
                            resultDiv.innerHTML = '<span class="badge bg-success">Success</span>' + resultHtml;
                        } else {
                            resultDiv.innerHTML = '<span class="badge bg-danger">Failed</span>' + resultHtml;
                        }
                    } catch (error) {
                        let errorHtml = '<pre class="code-viewer"><code>' + JSON.stringify(error.response.data, null, 2) + '</code></pre>';
                        resultDiv.innerHTML = '<span class="badge bg-danger">Error</span>' + errorHtml;
                    }
                });
            });
        }

        async function testApi(api) {
            const resultBadge = document.getElementById(`test-result-badge-${api.file}`);
            resultBadge.className = 'badge float-end bg-warning';
            resultBadge.textContent = 'Testing...';

            const endpoint = api.endpoints.find(ep => ep.action === 'list');
            if (!endpoint) {
                resultBadge.className = 'badge float-end bg-danger';
                resultBadge.textContent = 'No "list" action';
                return;
            }

            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}&secret_key=hospital-api-secret-2024`;
            
            // Add test user parameter for dashboard API
            if (api.file === 'dashboard.php') {
                url += '&test_user_id=1'; // Test with user ID 1
            }

            try {
                const response = await axios.get(url);
                if (response.data.success) {
                    resultBadge.className = 'badge float-end bg-success';
                    resultBadge.textContent = 'Success';
                } else {
                    resultBadge.className = 'badge float-end bg-danger';
                    resultBadge.textContent = 'Failed';
                }
            } catch (error) {
                resultBadge.className = 'badge float-end bg-danger';
                resultBadge.textContent = 'Error';
            }
        }

        async function testAllApis() {
            for (const api of apiEndpoints) {
                await testApi(api);
            }
        }

        function generateCurlExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${window.location.origin}${url}&secret_key=hospital-api-secret-2024`;
            
            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }
            
            return `curl -X ${endpoint.method} "${fullUrl}"`;
        }

        function generateJsExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${url}&secret_key=hospital-api-secret-2024`;
            
            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }
            
            return `axios({
    method: '${endpoint.method}',
    url: '${fullUrl}'
}).then(response => {
    console.log(response.data);
});`;
        }

        function generatePhpExample(api, endpoint) {
            let url = `/umakant/patho_api/${api.file}?action=${endpoint.action}${endpoint.params ? `&${endpoint.params.join('=&lt;value&gt;&')}=&lt;value&gt;` : ''}`;
            let fullUrl = `${window.location.origin}${url}&secret_key=hospital-api-secret-2024`;
            
            // Add user parameter example for dashboard API
            if (api.file === 'dashboard.php') {
                fullUrl += '&test_user_id=1';
            }
            
            const code = `<?php\n$url = "${fullUrl}";\n$response = file_get_contents($url);\n$data = json_decode($response, true);\nprint_r($data);\n?>`;
            return code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        testAllBtn.addEventListener('click', testAllApis);

        renderApiList();
        if (apiEndpoints.length > 0) {
            renderApiDocumentation(apiEndpoints[0]);
        }
    </script>
</body>
</html>
Tests API (https://hospital.codeapka.com/umakant/patho_api/test.php)

Overview
- JSON API endpoint: /patho_api/test.php
- Mirrors `ajax/test_api.php` behavior and fields.
- Session-based auth: create/update/delete require `admin` or `master` role.

Fields referenced by UI/screenshot
- id (int)
- category_id (int)
- category_name (string)
- name (string)
- description (text)
- price (decimal)
- unit (string)
- specimen (string)
- default_result (text)
- normal_range / reference_range (string)
- min (decimal)
- max (decimal)
- sub_heading (tinyint)
- test_code (string)
- method (string)
- print_new_page (tinyint)
- shortcut (string)
- added_by (int)
- added_by_username (string)

Actions / Usage

1) list
- Method: GET
- Params: action=list
- Response: { "success": true, "data": [ {<test object>} ] }
- Each test object contains the fields above; `added_by_username` is included when available.

2) get
- Method: GET
- Params: action=get&id=<id>
- Response: { "success": true, "data": {<test object>} }
- 404 if not found

3) save
- Method: POST
- Params (form-encoded): action=save; id (optional for update); category_id; name; description; price; unit; specimen; default_result; reference_range; min; max; sub_heading; test_code; method; print_new_page; shortcut
- Auth: session role `admin` or `master` required
- Response: { "success": true, "message": "Test created" } or { "success": true, "message": "Test updated" }

Notes:
- Upsert behavior: when creating a test, the API uses `test_code` (if provided) or `name+category_id` as unique keys. If a matching record exists the helper will `skip` the insert when fields match, or `update` when provided fields differ.
- `added_by` is set from the session user by default; if no session user is present the API will use `PATHO_API_DEFAULT_USER_ID` (configured in `inc/api_config.php`) as the `added_by` for new records when available.
- `added_by` is controlled server-side; clients cannot set it unless the requester is a master/admin and explicitly passes `added_by`.

4) delete
- Method: POST
- Params: action=delete&id=<id>
- Auth: session role `admin` or `master` required
- Response: { "success": true, "message": "Test deleted" }

Postman / curl examples
- List tests:
  curl "https://hospital.codeapka.com/umakant/patho_api/test.php?action=list"

- Get test:
  curl "https://hospital.codeapka.com/umakant/patho_api/test.php?action=get&id=10"

- Create test (POST):
  curl -X POST "https://yourhost/patho_api/test.php" \
    -d "action=save" \
    -d "category_id=2" \
    -d "name=CBC" \
    -d "description=Complete Blood Count" \
    -d "price=150" \
    -d "unit=g/dL" \
    -d "specimen=Blood" \
    -d "default_result=Normal" \
    -d "reference_range=4.5-11.0" \
    -d "min=4.5" -d "max=11.0" \
    -d "sub_heading=0" \
    -d "test_code=CBC001" \
    -d "method=Automated" \
    -d "print_new_page=0" \
    -d "shortcut=CBC" \
    --cookie "PHPSESSID=<session id>"

- Update test (POST):
  curl -X POST "https://yourhost/patho_api/test.php" \
    -d "action=save" \
    -d "id=10" \
    -d "name=Updated Name" \
    --cookie "PHPSESSID=<session id>"

- Delete test (POST):
  curl -X POST "https://yourhost/patho_api/test.php" \
    -d "action=delete" -d "id=10" \
    --cookie "PHPSESSID=<session id>"

Testing notes
- Use a valid session cookie from your web app when testing protected endpoints with Postman or curl.
- Endpoints return JSON responses and appropriate HTTP status codes on error.

Files created
- patho_api/test.php
- patho_api/Test.txt

Generated: Aug 26, 2025
